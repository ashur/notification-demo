---
layout: layouts/base.njk
externalScripts:
  - https://unpkg.com/alpinejs
---
<main
	class="[ stack ][ relative ][]"
>
	<article
		x-data="{}"
		class="[ stack-lg ][][ article ]"
	>
		{% if image %}
		{% Image "src/images/" + image.src, image.alt %}
		{% endif %}

		<div class="[ inset stack ][][ article-contents ]">
			<h1>{{ title or site.title }}</h1>
	
			{{ content | safe }}

			<ul>
				<li>Photo by <a href="{{ image.author.url }}">{{ image.author.name }}</a></li>
				<li>Text from Wikipedia</li>
			</ul>

		<button @click="$dispatch('reset')">Reset Demo</button>
	</article>

	<div
		x-data="{
			/* Properties */
			lastDisplayed: null,

			latest: {{ notifications | last | dump }},

			get url() {
				if( this.lastDisplayed !== this.latest.id )
				{
					return this.latest.url;
				}
			},

			/* Methods */
			init() {
				let url = new URL( window.location.href );
				if( url.pathname === this.latest.url )
				{
					this.lastDisplayed = this.latest.id;
					localStorage.setItem( 'lastDisplayed', this.lastDisplayed );
				}
				else
				{
					this.lastDisplayed = localStorage.getItem( 'lastDisplayed' );
				}
			},

			/* Demo-only */
			reset() {
				localStorage.removeItem( 'lastDisplayed' );
				this.lastDisplayed = null;
			},
		}"

		x-on:reset.window="reset()"
	>
		<div

			x-cloak
			x-show="url"

			class="[][][ notification ]"
		>
			<a x-bind:href="url">
				<span class="[][][]">Update available!</span>
			</a>
		</div>
	</div>
</main>
